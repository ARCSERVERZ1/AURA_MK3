{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Health Recorder</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary px-5" style="height: 120px;">
    <a class="navbar-brand" style="font-size: 2rem;" href="/home">Home /</a>
    <a class="navbar-brand" style="font-size: 2rem;">Medtrac /</a>
    <div class="ms-auto d-flex align-items-center gap-5">
      <!-- Dropdown -->
      <select id="navDropdown" class="form-select" style="font-size: 2rem; width: 200px; height:70px;">
        {% for name in users %}
          <option value="{{ name }}">{{ name }}</option>
        {% endfor %}
      </select>

      <!-- Add Button -->
      <button class="btn btn-light" id="addBtn" style="font-size: 2rem; width: 100px; height:70px;">Add</button>
    </div>
  </nav>

  <!-- Card Container -->
  <div class="container-fluid d-flex justify-content-center align-items-center p-4">
    <div id="healthCard" class="card bg-light text-dark p-5 my-5 mx-4 shadow rounded-4" style="display: none; width: 90%; height: 90%;">
      <h5 class="card-title" style="font-size: 4rem;">Health Recorder</h5>
      <div class="card-body d-flex flex-column justify-content-between">

        <!-- Form -->
        <form id="healthForm" method="POST" action="add_health_incident">
        {% csrf_token %}

          <div class="mb-3">
            <label class="form-label" style="font-size: 2.5rem;">Person *</label>
            <select id="Person" name = "Person" class="form-select" style="font-size: 2rem; height: 100px; border: 2px solid #343a40;" required>

              {% for name in users %}
                <option value="{{ name }}">{{ name }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label" style="font-size: 2.5rem;">Discomfort * & Severity *</label>
            <div class="row">
              <div class="col-9">
<!--                <input type="text" id="Discomfort" name = "Discomfort" class="form-control" style="font-size: 3.5rem; height: 100px; border: 2px solid #343a40;" required>-->
                 <select id="Discomfort" name = "Discomfort" class="form-select" style="font-size: 2rem; height: 100px; border: 2px solid #343a40;" required>
                   {% for discomfort in discomforts %}
                <option value="{{ discomfort.discomfort }}">{{ discomfort.discomfort }}</option>
                {% endfor %}
                    </select>
              </div>
              <div class="col-3">
                <select id="Severity" name = "Severity" class="form-select" style="font-size: 2rem; height: 100px; border: 2px solid #343a40;" required>
                  <option value="" disabled selected>Severity</option>
                  <option value="1">1</option>
                  <option value="10">10</option>
                </select>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label" style="font-size: 2.5rem;">Remarks</label>
            <textarea id="Remarks" name = "Remarks" class="form-control" style="font-size: 3.5rem; height: 200px; border: 2px solid #343a40;"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label" style="font-size: 2.5rem;">Medication *</label>
            <input type="text" name = "Medication" id="Medication" class="form-control" style="font-size: 3.5rem; height: 100px; border: 2px solid #343a40;" required>
          </div>

          <div class="mb-3">
            <label class="form-label" style="font-size: 2.5rem;">Approx Start * & End Time </label>
            <div class="row">
              <div class="col-6">
                <input type="datetime-local" id="start_time" name = "start_time" class="form-control" style="height: 100px; border: 2px solid #343a40;" required>
              </div>
              <div class="col-6">
                <input type="datetime-local" id="end_time" name = "end_time" class="form-control" style="height: 100px; border: 2px solid #343a40;">
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label" style="font-size: 2.5rem;">Remarks</label>
            <textarea id="After_Remarks" name = "After_Remarks" class="form-control" style="font-size: 3.5rem; height: 200px; border: 2px solid #343a40;"></textarea>
          </div>

          <div class="mb-3 d-flex justify-content-center my-5 gap-5">
            <button type="submit" class="btn btn-primary" style="padding: 1.5rem 3rem; font-size: 2.5rem;" id="recordBtn">Record Data</button>
            <button type="button" class="btn btn-secondary" style="padding: 1.5rem 3rem; font-size: 2.5rem;" id="cancelBtn">Cancel</button>
          </div>

        </form>
      </div>
    </div>
  </div>

<div class="container mt-5">
  <div style="white-space: nowrap; overflow-x: auto;">
    {% for user, records in all_records.items %}
      {% for record in records %}
        <div class="d-inline-block" style="margin-right: 1rem;">
          <div class="card" style="width: 80rem; height: 70rem; display: inline-block; overflow: hidden;">
            <small class="card-subtitle fw-bold mt-2 mx-2" style="font-size: 2.5rem;">MILD Severity [{{ record.severity }}]</small>
            <div class="card-body" style="overflow-wrap: break-word; word-break: break-word;">
              <h5 class="card-title" style="font-size: 2.5rem;">{{ record.discomfort }}</h5>
              <p class="card-text fw-bold mb-2">Medication : {{ record.medication }}</p>
              <small class="card-subtitle fw-bold">While!</small>
              <p class="card-text">{{ record.while_remarks }}</p>
              <small class="card-subtitle fw-bold">After!</small>
              <p class="card-text">{{ record.after_remarks }}</p>
              <p class="card-text">Start time : {{ record.apprx_start_time }}</p>
              <p class="card-text">End time : {{ record.apprx_end_time }}</p>
              <a href="#" class="btn btn-primary">Edit</a>
            </div>
          </div>
        </div>
      {% endfor %}
    {% endfor %}
  </div>
</div>



  <!-- Bootstrap + Script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const addBtn = document.getElementById('addBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const healthCard = document.getElementById('healthCard');
    const healthForm = document.getElementById('healthForm');

    addBtn.addEventListener('click', () => {
      healthCard.style.display = 'block';
    });

    cancelBtn.addEventListener('click', () => {
      healthCard.style.display = 'none';
    });

    healthForm.addEventListener('submit', (e) => {
      e.preventDefault(); // Stop normal form submit
      if (
        document.getElementById('Person').value &&
        document.getElementById('Discomfort').value.trim() &&
        document.getElementById('Severity').value &&
        document.getElementById('Medication').value.trim() &&
        document.getElementById('start_time').value
      ) {
<!--        alert('Form Submitted Successfully! ðŸŽ‰');-->
        healthForm.submit();
      } else {
        alert('Please fill all required fields marked with *');
      }
    });
  </script>

</body>
</html>
